syntax = "proto3";

package hub;

// gogo plugin toggles
option (gogoproto.gogoproto_import) = true;
option (gogoproto.goproto_registration) = true;
option (gogoproto.marshaler_all) = true;
option (gogoproto.messagename_all) = true;
option (gogoproto.sizer_all) = true;
option (gogoproto.unmarshaler_all) = true;
// golang option
option go_package = "hub";
// java options
option java_multiple_files = true;
option java_outer_classname = "HubProto";
option java_package = "io.btfs.hub";

import "github.com/gogo/protobuf/gogoproto/gogo.proto";
import "google/protobuf/timestamp.proto";

service HubQuery {
  rpc GetSettings(SettingsReq) returns (SettingsResp);
  rpc GetHosts(HostsReq) returns (HostsResp);
}

message SettingsReq {
  string id = 1;
  int32 resp_size = 2;
}

enum ResponseCode {
  SUCCESS = 0;
  SIGNATURE_FORMAT_ERROR = 1;
  COMPUTE_ADDRESS_ERROR = 2;
  OTHER_ERROR = 20;
}

message SettingsResp {
  ResponseCode code = 1;
  string message = 2;
  google.protobuf.Timestamp response_time = 3 [
    (gogoproto.nullable) = false,
    (gogoproto.stdtime) = true
  ];
  SettingsData settings_data = 4;
}

message SettingsData {
  double storage_price_ask = 1;
  double bandwidth_price_ask = 2;
  double storage_time_min = 3;
  double bandwidth_limit = 4;
  double collateral_stake = 5;
}

message HostsReq {
  string id = 1;
  int32 resp_size = 2;
}

message HostsResp {
  ResponseCode code = 1;
  string message = 2;
  HostsData hosts = 3;
  int32 resp_size = 4;
  string mode = 5;
  google.protobuf.Timestamp response_time = 6 [
    (gogoproto.nullable) = false,
    (gogoproto.stdtime) = true
  ];
}

message HostsData {
  repeated Host hosts = 1;
}

message Host {
  string node_id = 1;
  google.protobuf.Timestamp time_create = 2 [
    (gogoproto.nullable) = false,
    (gogoproto.stdtime) = true
  ];
  google.protobuf.Timestamp time_update = 3 [
    (gogoproto.nullable) = false,
    (gogoproto.stdtime) = true
  ];
  string node_ip = 4;
  string region = 5;
  string btfs_version = 6;
  float score = 7;
  int64 heart_beats = 8;
  float uptime = 9;
  int64 age = 10;
  double reputation = 11;
  double upload_avg = 12;
  uint64 upload_var = 13;
  double download_avg = 14;
  uint64 download_var = 15;
  Location location = 16 [(gogoproto.nullable) = false];
  StorageInfo storage_info = 17 [(gogoproto.nullable) = false];
  BandwidthInfo bandwidth_info = 18 [(gogoproto.nullable) = false];
  CollateralInfo collateral_info = 19 [(gogoproto.nullable) = false];
}

message Location {
  double lat = 1;
  double lon = 2;
}

message StorageInfo {
  uint64 storage_cap = 1;
  uint64 storage_left = 2;
  uint64 storage_min_time = 3;
  uint64 storage_ask_price = 4;
  uint64 storage_price_est = 5;
}

message BandwidthInfo {
  double bandwidth_limit = 1;
  uint64 bandwidth_ask_price = 2;
  uint64 bandwidth_price_est = 3;
}

message CollateralInfo {
  uint64 collateral_stake = 1;
  uint64 collateral_lost = 2;
  uint64 collateral_burn = 3;
}
